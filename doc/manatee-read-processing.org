* from "Hudson, Elizabeth" <elizabeth.hudson@louisville.edu>
Here is the URL that you can use in the command line AZcopy tool:
https://stcjuly2022.blob.core.windows.net/st183-lrgasp?sv=2021-10-04&st=2023-01-22T23%3A40%3A10Z&se=2023-02-28T23%3A40%3A00Z&sr=c&sp=rl&sig=4e0Nr2YiYuNyLpgaDPUxIJdwjL%2B%2BUbyOx2%2BUOtL4swc%3D

Just a reminder that that is not a direct link to your data, but to be used to copy it.

# mix of wtc-11 and manatee, filter by alignment

cd data/pb-sequencing-mixed/
azcopy copy --recursive 'https://stcjuly2022.blob.core.windows.net/st183-lrgasp?sv=2021-10-04&st=2023-01-22T23%3A40%3A10Z&se=2023-02-28T23%3A40%3A00Z&sr=c&sp=rl&sig=4e0Nr2YiYuNyLpgaDPUxIJdwjL%2B%2BUbyOx2%2BUOtL4swc%3D' .


* align reads to genome
cd align
(time nice minimap2 -t 64 -ax splice -p map-hifi ../reference/manatee.fa  ../../pb-sequencing-mixed/st183-lrgasp/ST183-LRGASP.hifi_reads.fastq.gz  | samtools sort -O BAM > pb-rna-manatee-genome.bam)>&pb.log&

(time nice minimap2 -t 64 -ax splice -p map-hifi ../reference/manatee.fa   ../reference/manatee-amplicons.fa  | samtools sort -O BAM > cntl-rna-manatee-genome.bam)>&cntl.log&
samtools index
ln -f *.bam* ../../../hub/manatee/



* amplicon target

cd reference
# have multiple amplicons for each target, so add transcript_id
tawk '$3==1{print ">" $1 "/" $5 " " $2;print $9}' ../../../../primers/primer-design/hub/manatee/juju_designs.manatee.isoforms.tsv  >manatee-amplicons.fa
samtools faidx manatee-amplicons.fa

cd align
(time nice minimap2 -ax map-hifi -t 32 ../reference/manatee-amplicons.fa ../../pb-sequencing-mixed/st183-lrgasp/ST183-LRGASP.hifi_reads.fastq.gz  | samtools sort -O BAM > pb-rna-manatee-amplicons.bam)>&pb.log&
nice samtools index -@ 32 pb-rna-manatee-amplicons.bam 

# control self-align
(time nice minimap2 -ax map-hifi -t 32 ../reference/manatee-amplicons.fa  ../reference/manatee-amplicons.fa | samtools sort -O BAM > cntl-rna-manatee-amplicons.bam)>&cntl.log&
nice samtools index -@ 32 cntl-rna-manatee-amplicons.bam 



** cd analyze
for sim in 1.0 0.99 0.98 0.95 0.90 ; do for plat in pb cntl ; do
   ../bin/simAmpSupport $plat $sim &
done ; done >&log

../../../bin/transcriptomeSummary pb-rna-manatee.*.tsv >pb-summary.tsv

tar -zcf ~/public_html/gencode/lrgasp/experimental-eval/manatee-support.tar.gz analyze

http://conesalab.org/LRGASP/LRGASP_manatee_hub/manatee/hub.txt

ln -f *.bam* ../../../hub/manatee/

cd hub/manatee
../../bin/mkBamsTrackDb *rna-manatee*.bam >filtered.trackDb.txt
bedToHtmlDir -public-browser -sort-by-name -title "LRGASP experimental validations targets" -hub https://hgwdev.gi.ucsc.edu/~markd/gencode/lrgasp/experimental-eval/hub/hub.txt -hub http://conesalab.org/LRGASP/LRGASP_manatee_hub/manatee/hub.txt manatee targets.bed dir



* check intron chains
cd data/manatee/analyze
for prot in pb cntl ; do
../../../bin/genomeAlignAnalyze ../../../hub/manatee/juju_designs.manatee.isoforms.tsv ../../../hub/manatee/targets.bed ../align/${prot}-rna-manatee-genome.bam --supportBam=${prot}.tmp.bam ${prot}-rna-manatee.intron-chains.tsv &
done >&log

for prot in pb cntl ; do
   samtools sort ${prot}.tmp.bam > ${prot}-rna-manatee.intron-chains.bam &
done
rm *.tmp.bam
for prot in pb cntl ; do
   samtools index ${prot}-rna-manatee.intron-chains.bam &
done

* final summary
cd manatee-transcriptome/analyze

../../../bin/summarizeSupport ../../../hub/hg38/juju_designs.hg38.isoforms.tsv --genomeStatsTsv=../../manatee/analyze/pb-rna-manatee.intron-chains.tsv --genomeStatsTsv=../../manatee/analyze/cntl-rna-manatee.intron-chains.tsv *-manatee.sim=*.tsv >manatee-support.tsv

cp manatee-support.tsv ~/public_html/lrgasp/experimental-eval/  
