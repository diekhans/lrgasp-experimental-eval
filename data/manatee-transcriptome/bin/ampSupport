#!/bin/bash
set -beEu -o pipefail

if [ $# != 3 ] ; then
    echo "wrong # args $0 maxEndsDiff maxIndelBases maxIndelBaseRate" >&2
    echo "Filters of -1 are omitted" >&2
    exit 1
fi

maxEndsDiff=$1
maxIndelBases=$2
maxIndelBaseRate=$3

mydir=$(dirname $(which $0))
transcriptomeAlignAnalyze=${mydir}/../../../bin/transcriptomeAlignAnalyze
bam=${mydir}/../align/pb-rna-manatee-amplicons.bam

outTsv="pb-rna-manatee.end=${maxEndsDiff}-indel=${maxIndelBases}-indelRate=${maxIndelBaseRate}.tsv"
outTmpTsv=$outTsv.tmp

opts=""

if [ ${maxEndsDiff} != -1 ] ; then
    opts="${opts} --maxEndsDiff=${maxEndsDiff}"
fi
if [ ${maxIndelBases} != -1 ] ; then
    opts="${opts} --maxIndelBases=${maxIndelBases}"
fi
if [ ${maxIndelBaseRate} != -1 ] ; then
    opts="${opts} --maxIndelBaseRate=${maxIndelBaseRate}"
fi


nice ${transcriptomeAlignAnalyze} ${opts} ${bam} ${outTmpTsv} 

mv -f $outTmpTsv $outTsv
